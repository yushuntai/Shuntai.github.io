---
layout: post
title:  " GSEA软件使用"
tags: 实验方法与科研小技巧
date:   2024-2-26
categories: Front-end JavaScript
excerpt: 实验方法与科研小技巧
---


**目录：**

* content
{:toc}
# 定义
GSEA, Gene set enrichment analysis: A knowledge-based approach for interpreting genome-wide expression profiles。确定是否一个预先定义的基因集能在两个生物学状态中显示出显著的一致性的差异。<br>

**预先定义的基因集**:首先它是一个基因集合，它包含的是感兴趣的基因，比如某个通路，某个GO term，或hall marker基因集可以是癌症。<br>
**两个生物学状态**:即实验组和对照组，和正常，男和女。<br>
**一致性差异**:也就是预定义的基因集中的基因在两个生物学状态中呈现出相似的差异状态;通俗一点就是某个通 路/GO条目中的基因集在实验组和对照组中呈现出一致的上调或者下调趋势。<br>


# 原始蛋白质谱的文件处理

原始文件进行修改，只需要留下Gene name和6个样本名字，如下：

![image](https://github.com/yushuntai/yushuntai.github.io/assets/61654690/03b9e0eb-3ff4-4c5f-a4da-c18d81d6e79d)


（1） 将空格全部改写成NA，同时把基因名为--的全部删除，删除的方法：选中基因名字列——排序和筛选——筛选——在gene name右侧的小三角中选中。

![image](https://github.com/yushuntai/yushuntai.github.io/assets/61654690/b2bb4c64-f6dc-4992-a1f3-206c9af8c1e4)


（2） 创建GSEA.txt文件并将上面excel中的信息粘贴进GSEA.txt文件
（3） 打开GSEA_4.3.3软件——Load data——Browse for files...——（这一步经常出问题，报错如下：

![image](https://github.com/yushuntai/yushuntai.github.io/assets/61654690/f6df98dc-fca2-4abb-ad5f-b157f45c1e23)

解决方法：
将文件中信息清除，然后手动打进去如下信息，再次导入GSEA软件，就会成功，提示如下。

![image](https://github.com/yushuntai/yushuntai.github.io/assets/61654690/7b847674-b431-46d0-bccd-0d6286f70ff3)


将上传成功的文件清除（Purge 3 Selected Files）

![image](https://github.com/yushuntai/yushuntai.github.io/assets/61654690/7a243f53-4038-4040-8039-051135ee9f8d)

将GSEA.txt文件中手打的内容清除，将excel中的信息粘贴进GSEA.txt文件，再次上传



点Phenotype labels——Create an on-the-fly Phenotype——填写好信息（要和.txt文件中的对应）如(1)所示——Apply to dataset——出现成功提示(2)后点确定再close——点(3)中的Show phenotypes from all source files——选中阴影处——OK
注：如果（3）中选的是ctrl vs ANKRD5-ko,cls#ANKRD5-ko versus ctrl 则最终出的结果是ANKRD5-ko上调的，如果选的是 ctrlvs ANKRD5-ko.cls#ctrl versus ANKRD5-KO 则最终出的结果是ctrl上调的。

![image](https://github.com/yushuntai/yushuntai.github.io/assets/61654690/3c58b7c0-dac5-48bd-b922-b506c460591b)


## Required fields
**Expression dataset**：导入表达数据集文件，点击后自动显示上一一步中从本地导入软件内的文件，所以定要确认上一步等入数据是否成功。我的文档显示的是  **GSEA [4896x6 (ann: 4896,6,chip na)]**  <br>
**Gene sets database**：这是软件自带的基因功能集数据库，包括GO/KEGG/wikipathway等等，可以几个数据库都试试，看能不能富集到一些有用信息，也可以下载GSEA官网中的gene sets文件，然后自己导入。<br>
**Number of permutations**:置换检验的次数，数字越大结果越准确，但是太大会占用太多内存，软件默认检验1000次。软件分析时会得到一个基因富集的评分(ES)，但是富集评分是否具有统计学意义，软件就会采用随机模拟的方法，根据指定参数随机打乱1000次，得到到1000个富集评分，然后判断得到的ES是否在这1000个随机产生的得分中有统计学意义。测试使用时建议填一个很小的数如10，先让程序跑通。真正分析时再换为1000。 <br>
**Phenotype labels**:选择比较方式，若文件只有2个分组，任意选一个就行，哪个在前在后全在自己怎么解释方便，若数据有多组（比如肿瘤A、肿瘤B、肿瘤C等等）的话，GSEA会提供两两间比较的组合选项或者某一组与剩下所有组的比较。选择好后，GSEA会在分析过程中根据组别信息自动到表达数据集文件中提取对应的数据作比较。<br>
**Collapse/Remap to gene symbols**：是用于基因芯片探针号转化成gene symbols的，这里不用转置，所以选No_Collapse。<br>
**Permutation type**：置换检验的类型，若每组样本数＞7个，建议选择phenotype，否则就gene_set。<br>
**Chip platform**：是基因芯片的数据才需要设置的，目的是对ID进行注释转换，所以这里直接空着就行。<br>



## Basic fields
**Metric for ranking genes**：是统计方式。如果表型是分组信息（如对照与基因敲除；肿瘤与正常等），GSEA在计算分组间的差异值时支持5种统计方式，分别是：signal2noise（这个是默认的，一般也都用这个。）、t-Test、ratio of class、diff_of_class(log2转换后的值计算倍数)、log2_ratio_of_class。如果表型是连续数值信息（身高、体重等）时，使用的统计方式是：pearson、Spearman、cosine、Manhattan、Euclidean。<br>
**Max size: exclude larger sets** 和 **Min size: exclude smaller sets**表示如果要进行GSEA运算则需要满足的富集到的最大基因数和最小基因数，这里是可以自由调整的，我将后者调为了1，因为我的样本数量少的问题。<br>
**Save results in this folder**:结果保存的位置，可以更改。<br>

## Advanced fields
**Collapsing mode for probe sets => 1 gene**:多个探针对应一个基因时的处理方式。<br>
**Normalized mode**: 富集得分的标准化方式。<br>
**Seed for permutation**：随机数种子，如果想让每次结果一致，这里需要设置同样一个整数。<br>
**Randomization mode**:只用于phenotype permutation.<br>
**Median for class metrics**:计算metrics ranking时用中值而不是平均值。<br>
**Number of markers**:红蝶图中展示的Gene Marker数目。<br>
**Plot graphs for the top sets of each phenotype**:绘制多少GSEA plot，默认top 20，其它不绘制。一般会把这个值调高一些。<br>

Basic fields和Advanced fields里面的东西一般就不用动了。

## 自定义基因集

**主要参考** [Sperm motility defects相关基因](http://mik.bicnirrh.res.in/index.html)  ——Search——infertility phenotypes——sperm motility defects

这些基因全部下载下来，并且将其改为首字母大写后面小写的形式（使用LOWER函数全部改为小写，再使用PROPER函数改为首字母大写，也可以直接用嵌套的函数=PROPER(LOWER(X))）。

点开Gene sets database——Text entry——将上面的基因名全部填写进去——OK——run——最终结果如图所示

![image](https://github.com/yushuntai/yushuntai.github.io/assets/61654690/9e9f1bcc-c87f-4ca2-8e08-8e78f91288b7)


Run Gsea最终的页面如下所示

![image](https://github.com/yushuntai/yushuntai.github.io/assets/61654690/5b5f3956-97c4-450d-9ee1-724043bc0d9a)










TE抗原修复：100℃ 40min，常温冷却至室温。<br>
(6) 取出1/3 精子用于精子涂片，其余精子先做抗体孵育然后涂片子。 <br>

# 各个文件的信息介绍。

![image](https://github.com/yushuntai/yushuntai.github.io/assets/61654690/03d092c5-a5be-4ed8-9586-246202b3c328)


（1）.obf是原始文件，可以用stedycon、fiji、Huygens等软件打开，如果是层扫的，则用stedycon打开该原始文件后能看到有Z轴可以调节。<br>（2）.zip 压缩包里的tiff文件是单通道文件。<br>（3）.txt文件是拍照时候的一些信息。<br>

![image](https://github.com/yushuntai/yushuntai.github.io/assets/61654690/00cdcdbb-c027-4c8f-8eea-1519dd9b3d12)

（1）名字中后缀的 ch00 和 ch01是两个不同的荧光通道。两个Z000_ch00和Z000_ch01是同一个Z平面两个荧光通道的照片。Z000、Z001、Z002 是属于不同的Z平面<br>


StedyconGallery-9.0.538-gf4f0d25-win64.msi，可以打开Abberior STEDYCON拍摄的原始文件，可以查看和简单测量，可以将文件导出成图片或PDF格式

**主要参考** [STEDYCON下载链接](https://cloud.tsinghua.edu.cn/f/e82232f882fc47c39eb7/)   
安装路径全部用英文名，将STEDYCON下载的obf文件解压到全英文路径，双击obf文件即可打开

# 打开原文件

STEDYCON 软件打开.obf 文件
![image](https://github.com/yushuntai/yushuntai.github.io/assets/61654690/0cf0fd68-fe7e-41a4-a1b6-01c39c3a583e)
根据该原文件中的颜色分布和当时染色的颜色搭配来确定TIF灰度图文件中ch00 和 ch01分别是染的哪个蛋白，根据不同的Z轴来选择不同的Z平面。

# FIJI image J对文件进行调色和编辑

打开Fiji imageJ软件。我用的FLAG（R）和Tubulin（m），ch00 为 FLAG 绿色，ch01 为 tubulin 红色，tubulin和FLAG都是用的1:500，这次抗体浓度太稀了，下次提高抗体浓度和解决背景太高的问题。

![image](https://github.com/yushuntai/yushuntai.github.io/assets/61654690/a795b8f7-c3a9-4dab-8d5b-fa7533ea721b)


**添加伪彩**：将TIF图片拉进FIJI image J——LUT——Green（点另一个图片，选Red）<br>
**调对比度**：Image——adjust——Brightness/Contrast（Color Balance，我觉得用color balance调的更好）——minimum是去背景，让暗的更暗，Maximum是让一些亮的更亮<br>
**Merge图片**：Image——color——Merge Channel——C1选上一个图片，C2选上一个图片——OK即可<br>
**Merge后的调整**：滑动merge好的图片下方的键又会出现Color键，在这里也可以调节颜色和对比度之类的。<br>
**图片的输出**：file——save as——Jpeg或者png等。<br>






